<!DOCTYPE html>
<html>
	<head>
		<title>Settings - InfiniMii</title>
		<link rel="stylesheet" href="./global.css">
        <link rel="stylesheet" href="utilityPages.css">
	</head>
	<body>
		<%- header %>
		<div class="account">
				<img src="miiImgs/<%= pfp %>.jpg"> <%= thisUser %>
				<div class="accDropdown">
					<a href="/user?user=<%= thisUser %>">Profile</a>
					<a href="/logout">Logout</a>
				</div>
		</div>
		<div class="content">
			<div class="left-sidebar">
				<ul class="sidebar-list">
					<a href="/search"><li>üîç Search</li></a>
					<a href="/top"><li>üìà Top Miis</li></a>
					<a href="/best"><li>ü•á All-Time Top Miis</li></a>
					<a href="/recent"><li>‚è±Ô∏è Recent Miis</li></a>
					<a href="/official"><li>üåü Official Miis</li></a>
				</ul>
				<br>
				<ul class="sidebar-list">
					<a href="/upload"><li>‚¨ÜÔ∏è Upload</li></a>
					<a href="<%= thisUser==='default'?'/signup':'/user?user='+thisUser %>"><li><img src="miiImgs/<%= pfp %>.jpg" width="18px" height="18px"> Profile</li></a>
					<a href="/settings"><li>‚öôÔ∏è Settings</li></a>
					<a href="/convert"><li>‚û°Ô∏è Convert</li></a>
					<a href="/qr"><li>üì∏ QR Options</li></a>
				</ul>
			</div>
			<div class="settings-container">
				<fieldset>
					<legend>Profile Settings</legend>
					
					<!-- Change Profile Picture -->
					<div class="setting-group">
						<label>Profile Picture (Mii ID)</label>
						<input type="text" placeholder="Mii ID for new Profile Picture" id="pfpId">
						<button onclick="changePfp()">Change Profile Picture</button>
					</div>

					<!-- Change Username -->
					<div class="setting-group">
						<label>Username</label>
						<input type="text" placeholder="New Username" id="nUser">
						<button onclick="changeUser()">Change Username</button>
					</div>
				</fieldset>

				<fieldset>
					<legend>Account Settings</legend>

					<!-- Change Email -->
					<div class="setting-group">
						<label>Email Address</label>
						<input type="email" placeholder="Old Email" id="oEmail">
						<input type="email" placeholder="New Email" id="nEmail">
						<button onclick="changeEmail()">Change Email</button>
					</div>
					
					<!-- Change Password -->
					<div class="setting-group">
						<label>Password</label>
						<input type="password" placeholder="Old Password" id="oPass">
						<input type="password" placeholder="New Password" id="nPass">
						<button onclick="changePassword()">Change Password</button>
					</div>
				</fieldset>

				<fieldset class="danger-zone">
					<legend>‚ö†Ô∏è Danger Zone</legend>

					<!-- Delete All Miis -->
					<div class="setting-group">
						<label>Delete All Your Miis</label>
						<p class="warning-text">This will permanently delete ALL Miis you have uploaded. This action cannot be undone!</p>
						<button class="danger-btn" onclick="deleteAllMiis()">üóëÔ∏è Delete All My Miis</button>
					</div>

					<!-- Delete Account -->
					<div class="setting-group">
						<label>Delete Account</label>
						<p class="warning-text">This will permanently delete your account. Your Miis will remain on the site but will be attributed to "[Deleted User]". This action cannot be undone!</p>
						<input type="password" placeholder="Enter Password to Confirm" id="deleteAccountPassword">
						<button class="danger-btn" onclick="deleteAccount()">‚õî Delete Account</button>
					</div>
				</fieldset>
			</div>

            <div class="browse-featured-miis">
                <div class="title-container">
                    <h2>Highlighted Mii</h2>
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAScAAAAyCAYAAAAeNh3dAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowN0Q4NEI4MEYyRjUxMUUyQkIyQzgyMzFDMDNCRTc0OSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowN0Q4NEI4MUYyRjUxMUUyQkIyQzgyMzFDMDNCRTc0OSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM5RDJFRTU3RjBCRjExRTJCQjJDODIzMUMwM0JFNzQ5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM5RDJFRTU4RjBCRjExRTJCQjJDODIzMUMwM0JFNzQ5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+wjmikgAABsNJREFUeNrsnb9v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" height='20' width='205' />
                </div>
                <div class="mii-card">
                    <a href='/mii?id=<%= highlightedMii.id %>'><img src="miiImgs/<%= highlightedMii.id %>.jpg"></a>
                    <div class="flex">
                        <div>
                            <h3><%= highlightedMii.meta.name %></h3>
                            <a href="/user?user=<%= highlightedMii.uploader %>"><%= highlightedMii.uploader %></a>
                        </div>
                    </div>
                    <p><%= highlightedMii.desc.length>75?highlightedMii.desc.slice(0,73)+"...":highlightedMii.desc %></p>
                </div>
                <br>
                <div class="title-container">
                    <h2>Average Mii</h2>
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAScAAAAyCAYAAAAeNh3dAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIE1hY2ludG9zaCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowN0Q4NEI4MEYyRjUxMUUyQkIyQzgyMzFDMDNCRTc0OSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowN0Q4NEI4MUYyRjUxMUUyQkIyQzgyMzFDMDNCRTc0OSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM5RDJFRTU3RjBCRjExRTJCQjJDODIzMUMwM0JFNzQ5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM5RDJFRTU4RjBCRjExRTJCQjJDODIzMUMwM0JFNzQ5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+wjmikgAABsNJREFUeNrsnb9v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" height='20' width='205' />
                </div>
                <div class="mii-card">
                    <a href='/mii?id=average'><img src="miiImgs/average.jpg"></a>
                    <div class="flex">
                        <div>
                            <h3><%= averageMii.general.gender>0?"Jane":"John" %> Doe</h3>
                            <a>Everyone</a>
                        </div>
                    </div>
                    <p>The most common or average features and placements of those features across all Miis on the website</p>
                </div>
            </div>
		</div>
		<footer>
			<ul>
				<li><a href="mailto:kestron@kestron.com">Contact</a></li>
				<li><a href="/donate">Donate</a></li>
				<li><a href='https://discord.gg/k3yVkrrvez'>Discord</a></li>
			</ul>
		</footer>
		<script src="global.js"></script>
		<script>
			async function changePfp() {
				const pfpId = document.getElementById('pfpId').value;
				if (!pfpId) {
					alert('Please enter a Mii ID');
					return;
				}

				try {
					const response = await fetch(`/changePfp?id=${encodeURIComponent(pfpId)}`);
					const result = await response.json();
					
					if (result.okay) {
						alert('Profile picture changed successfully!');
						location.reload();
					} else {
						alert(result.msg || 'Error changing profile picture');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to change profile picture');
				}
			}

			async function changeUser() {
				const newUser = document.getElementById('nUser').value;
				if (!newUser) {
					alert('Please enter a new username');
					return;
				}

				const confirmed = confirm(`Are you sure you want to change your username to "${newUser}"?`);
				if (!confirmed) return;

				try {
					const response = await fetch(`/changeUser?newUser=${encodeURIComponent(newUser)}`);
					const result = await response.json();
					
					if (result.okay) {
						alert('Username changed successfully! Please log in again.');
						window.location.href = '/login';
					} else {
						alert(result.msg || 'Error changing username');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to change username');
				}
			}

			async function changeEmail() {
				const oldEmail = document.getElementById('oEmail').value;
				const newEmail = document.getElementById('nEmail').value;

				if (!oldEmail || !newEmail) {
					alert('Please fill in both old and new email');
					return;
				}

				try {
					const response = await fetch('/changeEmail', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ oldEmail, newEmail })
					});

					const result = await response.json();
					
					if (result.okay) {
						alert('Email changed successfully!');
						document.getElementById('oEmail').value = '';
						document.getElementById('nEmail').value = '';
					} else {
						alert(result.msg || 'Error changing email');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to change email');
				}
			}

			async function changePassword() {
				const oldPass = document.getElementById('oPass').value;
				const newPass = document.getElementById('nPass').value;

				if (!oldPass || !newPass) {
					alert('Please fill in both old and new password');
					return;
				}

				if (newPass.length < 6) {
					alert('New password must be at least 6 characters');
					return;
				}

				try {
					const response = await fetch('/changePassword', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ oldPassword: oldPass, newPassword: newPass })
					});

					const result = await response.json();
					
					if (result.okay) {
						alert('Password changed successfully!');
						document.getElementById('oPass').value = '';
						document.getElementById('nPass').value = '';
					} else {
						alert(result.msg || 'Error changing password');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to change password');
				}
			}

			async function deleteAllMiis() {
				const confirmed = confirm('‚ö†Ô∏è WARNING ‚ö†Ô∏è\n\nAre you ABSOLUTELY SURE you want to DELETE ALL YOUR MIIS?\n\nThis action CANNOT be undone!');
				if (!confirmed) return;

				const doubleCheck = prompt('Type "DELETE ALL" to confirm:');
				if (doubleCheck !== 'DELETE ALL') {
					alert('Deletion cancelled.');
					return;
				}

				try {
					const response = await fetch('/deleteAllMyMiis', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' }
					});

					const result = await response.json();
					
					if (result.okay) {
						alert(`Successfully deleted ${result.deletedCount} Miis`);
						location.reload();
					} else {
						alert(result.msg || 'Error deleting Miis');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to delete Miis');
				}
			}

			async function deleteAccount() {
				const password = document.getElementById('deleteAccountPassword').value;

				if (!password) {
					alert('Please enter your password to confirm account deletion');
					return;
				}

				const confirmed = confirm('‚ö†Ô∏è FINAL WARNING ‚ö†Ô∏è\n\nAre you ABSOLUTELY SURE you want to DELETE YOUR ACCOUNT?\n\nYour Miis will remain on the site but will be attributed to "[Deleted User]".\n\nThis action CANNOT be undone!');
				if (!confirmed) return;

				const tripleCheck = prompt('Type "DELETE MY ACCOUNT" to confirm:');
				if (tripleCheck !== 'DELETE MY ACCOUNT') {
					alert('Account deletion cancelled.');
					return;
				}

				try {
					const response = await fetch('/deleteAccount', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ password })
					});

					const result = await response.json();
					
					if (result.okay) {
						alert('Account deleted successfully. Goodbye!');
						window.location.href = '/';
					} else {
						alert(result.msg || 'Error deleting account');
					}
				} catch (error) {
					console.error('Error:', error);
					alert('Failed to delete account');
				}
			}
		</script>
	</body>
</html>