<!DOCTYPE html>
<html lang="en">
<head>
    <%
    const pageTitle = 'Upload Mii Character - Share Your Miis | InfiniMii';
    const pageDesc = 'Upload and share your custom Mii characters with the InfiniMii community. Support for Wii .mii files, 3DS/Wii U .bin files, and QR codes. Free Mii character sharing platform.';
    const canonicalUrl = 'https://yourdomain.com/upload';
    const keywords = 'upload mii, share mii, submit mii, mii community, mii repository, publish mii character';
    %>
    <%- include('../ejsPartials/metaTags', { title: pageTitle, description: pageDesc, canonicalUrl, keywords }) %>
    <%- include('../ejsPartials/structuredData') %>
    
    <!-- HowTo Schema for Uploading -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "HowTo",
      "name": "How to Upload and Share Mii Characters on InfiniMii",
      "description": "Step-by-step guide to upload your Mii characters to InfiniMii and share them with the community.",
      "image": "https://yourdomain.com/guide-images/upload-guide.jpg",
      "totalTime": "PT3M",
      "estimatedCost": {
        "@type": "MonetaryAmount",
        "currency": "USD",
        "value": "0"
      },
      "tool": [
        {
          "@type": "HowToTool",
          "name": "Mii file (.mii for Wii or .bin for 3DS/Wii U) or QR code image"
        }
      ],
      "step": [
        {
          "@type": "HowToStep",
          "name": "Select Mii Format",
          "text": "Choose whether you're uploading a Wii Mii (.mii file) or a 3DS/Wii U Mii (.bin file or QR code image).",
          "position": 1
        },
        {
          "@type": "HowToStep",
          "name": "Choose Your Mii File",
          "text": "Click the file upload button and select your Mii file from your device. Accepted formats are .mii, .bin, .png, or .jpg.",
          "position": 2
        },
        {
          "@type": "HowToStep",
          "name": "Write a Description",
          "text": "Add a description (up to 250 characters) explaining what your Mii is, who it represents, or any special features. This helps others find and appreciate your creation.",
          "position": 3
        },
        {
          "@type": "HowToStep",
          "name": "Submit Your Mii",
          "text": "Click the submit button to upload your Mii to InfiniMii. It will be added to the community repository and browsable by all users.",
          "position": 4
        }
      ]
    }
    </script>
    
    <link rel='stylesheet' href="global.css">
    <link rel="stylesheet" href="utilityPages.css">
    
    <!-- Preconnect to improve performance -->
    <link rel="dns-prefetch" href="https://yourdomain.com">
</head>
<body>
    <%- partials.header %>
    <%- partials.accountDisplay %>
    
    <main class='content' role="main">
        <%- partials.sidebar %>
        
        <article class='upload utility-container'>
            <!-- TL;DR for AI -->
            <div class="tldr-box" style="background: var(--layer-3); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid var(--brand-color);">
                <h2 style="margin-top: 0; font-size: 1.1rem;">Quick Summary</h2>
                <p><strong>Upload your Mii characters to InfiniMii</strong> and share them with thousands of users. Supports Wii .mii files, 3DS/Wii U .bin files, and QR code images. Add a description, submit, and your Mii becomes part of our community repository.</p>
            </div>
            
            <h1>Upload Your Mii to InfiniMii</h1>
            
            <!-- What is Mii Uploading Section -->
            <section class="what-is-uploading" style="margin-bottom: 2rem;">
                <h2>What is Mii Uploading?</h2>
                <p>Uploading a Mii to InfiniMii means sharing your custom Mii character with our global community. Your Mii becomes part of our comprehensive database where other users can:</p>
                <ul>
                    <li><strong>Browse and discover</strong> your creation</li>
                    <li><strong>Download</strong> your Mii to their Nintendo systems</li>
                    <li><strong>Generate QR codes</strong> from your Mii</li>
                    <li><strong>Vote and like</strong> Miis they appreciate</li>
                    <li><strong>Convert formats</strong> using your uploaded Mii</li>
                </ul>
            </section>
            
            <!-- Upload Instructions -->
            <div class="upload-instructions" style="background-color: var(--layer-3); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                <h2 style="margin-top: 0;">Before You Upload</h2>
                <ul style="margin: 0;">
                    <li><strong>Supported formats:</strong> Wii .mii files, 3DS/Wii U .bin files, or QR code images (.jpg, .png)</li>
                    <li><strong>File requirements:</strong> Your Mii file must be valid and uncorrupted</li>
                    <li><strong>Description required:</strong> Explain what your Mii represents (max 250 characters)</li>
                    <li><strong>Original content:</strong> Upload only Miis you created or have permission to share</li>
                    <li><strong>Official Miis:</strong> Only Researchers and Administrators can mark Miis as official Nintendo Miis</li>
                    <li><strong>Community guidelines:</strong> Be respectful and follow InfiniMii's community standards</li>
                </ul>
            </div>
            
            <!-- Main Upload Form -->
            <form action="/uploadMii" method="post" enctype="multipart/form-data" id='uploadForm'>
                <fieldset>
                    <legend>Upload a Mii Character</legend>
                    
                    <!-- Alternative: Scan QR Code -->
                    <div style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: 6px;">
                        <strong>üí° Tip:</strong> Have a QR code instead? <a href="/qr" style="color: var(--brand-color); text-decoration: underline;">Scan it with your camera first</a>, then upload
                    </div>
                    
                    <!-- Step 1: Select Format -->
                    <div class="form-section">
                        <label class="form-label"><strong>Step 1:</strong> Select Your Mii Format</label>
                        <div class="radio-group" style="display: flex; gap: 1.5rem; margin: 1rem 0;">
                            <div class="radio-option" style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" id="format-3ds" value="3ds" name="type" checked required>
                                <label for="format-3ds" style="cursor: pointer; margin: 0;">
                                    <strong>3DS/Wii U</strong><br>
                                    <small style="color: var(--text-2);">QR codes, .bin files</small>
                                </label>
                            </div>
                            <div class="radio-option" style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" id="format-wii" value="wii" name="type">
                                <label for="format-wii" style="cursor: pointer; margin: 0;">
                                    <strong>Wii</strong><br>
                                    <small style="color: var(--text-2);">.mii files</small>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Step 2: Upload File -->
                    <div class="form-section" style="margin-top: 1.5rem;">
                        <label for="mii-file" class="form-label"><strong>Step 2:</strong> Choose Your Mii File</label>
                        <p class="helper-text" style="color: var(--text-2); margin: 0.5rem 0;">
                            Accepted formats: <code>.mii</code> (Wii), <code>.bin</code> (3DS/Wii U), <code>.jpg</code>/<code>.png</code> (QR codes)
                        </p>
                        <input 
                            type="file" 
                            id="mii-file"
                            name="mii" 
                            accept=".mii,.bin,.png,.jpg" 
                            required
                            aria-required="true"
                            aria-describedby="file-help">
                        <small id="file-help" style="display: block; margin-top: 0.5rem; color: var(--text-2);">
                            Maximum file size: 5MB
                        </small>
                    </div>
                    
                    <!-- Step 3: Description -->
                    <div class="form-section" style="margin-top: 1.5rem;">
                        <label for="mii-description" class="form-label"><strong>Step 3:</strong> Describe Your Mii</label>
                        <p class="helper-text" style="color: var(--text-2); margin: 0.5rem 0;">
                            Tell the community about your Mii. What character does it represent? Any special features or creation notes?
                        </p>
                        <textarea 
                            id="mii-description"
                            maxlength="250" 
                            rows="5" 
                            placeholder="Example: This is my recreation of Link from The Legend of Zelda: Breath of the Wild. I tried to capture his determined expression and iconic hairstyle. Works great in Mario Kart!"
                            name="desc"
                            required
                            aria-required="true"
                            style="width: 100%; padding: 0.75rem; font-family: inherit;"></textarea>
                        <small style="color: var(--text-2);">
                            <span id="char-count">0</span>/250 characters
                        </small>
                    </div>
                    
                    <!-- Official Mii Checkbox (Only for Researchers/Admins) -->
                    <% if(users[thisUser] && (users[thisUser].roles?.includes('researcher') || 
                          users[thisUser].roles?.includes('administrator') || 
                          users[thisUser].role==='researcher' || 
                          users[thisUser].role==='administrator')) { %>
                        <div class="form-section official-section" style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 200, 0, 0.1); border: 2px solid rgba(255, 200, 0, 0.3); border-radius: 8px;">
                            <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
                                <input type="checkbox" id="official-mii" name="official" style="margin-top: 0.25rem;">
                                <label for="official-mii" style="margin: 0;">
                                    <strong style="color: #ffd700;">‚≠ê Official Nintendo Mii</strong><br>
                                    <small style="color: var(--text-2); line-height: 1.5;">
                                        Check this box ONLY if this is an <strong>exact copy</strong> of a Mii that appears in an official Nintendo game, promotional material, or console. 
                                        You must mention the source (game/promo) in your description. 
                                        <strong style="color: #ff6b6b;">Falsely marking a Mii as official may result in removal and account penalties.</strong>
                                    </small>
                                </label>
                            </div>
                        </div>
                    <% } %>
                    
                    <!-- Step 4: Submit -->
                    <div class="form-section" style="margin-top: 2rem;">
                        <input 
                            type="submit" 
                            value="Upload My Mii to InfiniMii" 
                            style="width: 100%; padding: 1rem; font-size: 1.1rem; background: var(--brand-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.3s;"
                            onmouseover="this.style.opacity='0.9'"
                            onmouseout="this.style.opacity='1'">
                    </div>
                </fieldset>
            </form>
            
            <!-- FAQ Section -->
            <section class="upload-faq" style="margin-top: 3rem;">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">What file formats can I upload?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> InfiniMii accepts Wii .mii files, 3DS/Wii U .bin files, and QR code images (.jpg or .png). All formats are processed automatically.
                    </p>
                </div>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">How do I get a Mii file from my Nintendo system?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> For 3DS/Wii U, use Mii Maker to save your Mii as a QR code, then screenshot it. For Wii, you'll need homebrew tools to extract .mii files. See our <a href="/guides/transfer" style="color: var(--brand-color);">transfer guide</a> for detailed instructions.
                    </p>
                </div>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Can I upload Miis I didn't create?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> You can upload any Mii character, but please give proper credit in the description if it's a recreation of someone else's work. Only mark Miis as "Official" if they're from Nintendo games/materials.
                    </p>
                </div>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">What makes a good Mii description?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> Include: (1) Who or what the Mii represents, (2) Any special features or creation techniques, (3) Games/contexts where it works well, (4) Credits if it's a recreation. Example: "Mario from Super Mario Odyssey with his red cap and iconic mustache."
                    </p>
                </div>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">How many Miis can I upload?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> There is no limit! Upload as many Miis as you want to share with the community. All uploaded Miis are stored permanently in our repository.
                    </p>
                </div>
                
                <div class="faq-item" style="margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Can I edit or delete my uploaded Miis?</h3>
                    <p style="margin: 0; color: var(--text-2);">
                        <strong>Answer:</strong> Yes! Visit your <a href="/user/<%= thisUser %>" style="color: var(--brand-color);">profile page</a> to view all your uploaded Miis. Moderators can help with edits or deletions if needed.
                    </p>
                </div>
            </section>
            
            <!-- Related Links -->
            <section class="related-links" style="margin-top: 2rem; padding: 1.5rem; background: var(--layer-3); border-radius: 10px;">
                <h2 style="margin-top: 0;">Related Tools & Resources</h2>
                <ul style="margin: 0;">
                    <li><a href="/qr" style="color: var(--brand-color);">QR Code Scanner</a> - Scan QR codes before uploading</li>
                    <li><a href="/convert" style="color: var(--brand-color);">Mii Converter</a> - Convert formats before uploading</li>
                    <li><a href="/guides/transfer" style="color: var(--brand-color);">Transfer Guide</a> - Learn how to extract Miis from your systems</li>
                    <li><a href="/" style="color: var(--brand-color);">Browse Miis</a> - See what others have uploaded</li>
                    <li><a href="/faq" style="color: var(--brand-color);">FAQ</a> - More questions answered</li>
                </ul>
            </section>
        </article>
        
        <%- partials.featuredMiis %>
    </main>
    
    <%- partials.footer %>
    
    <!-- Character Counter Script -->
    <script>
        // Character counter for description
        const textarea = document.getElementById('mii-description');
        const charCount = document.getElementById('char-count');
        
        if (textarea && charCount) {
            textarea.addEventListener('input', function() {
                charCount.textContent = this.value.length;
                if (this.value.length >= 250) {
                    charCount.style.color = '#ff6b6b';
                } else if (this.value.length >= 200) {
                    charCount.style.color = '#ffd700';
                } else {
                    charCount.style.color = 'var(--text-2)';
                }
            });
        }
        
        // Form validation enhancement
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            const fileInput = document.getElementById('mii-file');
            const description = document.getElementById('mii-description');
            
            if (!fileInput.files.length) {
                e.preventDefault();
                alert('Please select a Mii file to upload.');
                return false;
            }
            
            if (description.value.trim().length < 10) {
                e.preventDefault();
                alert('Please provide a more detailed description (at least 10 characters).');
                description.focus();
                return false;
            }
            
            // Visual feedback
            const submitBtn = this.querySelector('input[type="submit"]');
            submitBtn.value = 'Uploading...';
            submitBtn.disabled = true;
        });
    </script>
    <script src="global.js" defer></script>
</body>
</html>